<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Horario</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .container { max-width: 600px; margin: auto; }
    video, canvas { width: 100%; max-height: 300px; }
    button { margin-top: 10px; padding: 10px 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Coastal VA Marine Construction - Registro de Horario</h2>

    <label for="registroTipo">Tipo de Registro:</label>
    <select id="registroTipo">
      <option value="Ingreso">Ingreso</option>
      <option value="Cambio de Proyecto">Cambio de Proyecto</option>
      <option value="Salida">Salida</option>
    </select>

    <h3>Selecciona Empleados:</h3>
    <div id="empleados">
      <label><input type="checkbox" value="Juan Pérez"> Juan Pérez</label><br>
      <label><input type="checkbox" value="Ana Morales"> Ana Morales</label><br>
      <label><input type="checkbox" value="Carlos Díaz"> Carlos Díaz</label><br>
    </div>

    <h3>Foto de Grupo:</h3>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <button id="capture">Capturar Foto</button>
    <button id="enviar">Enviar Registro</button>

    <p id="status"></p>
  </div>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const captureBtn = document.getElementById('capture');
    const enviarBtn = document.getElementById('enviar');
    const statusMsg = document.getElementById('status');
    let fotoBase64 = "";

    // Acceso a cámara trasera
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
      .then(stream => { video.srcObject = stream; })
      .catch(err => { statusMsg.textContent = "Error al acceder a la cámara: " + err; });

    captureBtn.onclick = () => {
      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0);
      fotoBase64 = canvas.toDataURL('image/jpeg');
      statusMsg.textContent = "Foto capturada.";
    };

    enviarBtn.onclick = () => {
      const seleccionados = [...document.querySelectorAll('#empleados input:checked')].map(e => e.value);
      if (!fotoBase64 || seleccionados.length === 0) {
        alert("Debes seleccionar empleados y capturar una foto antes de enviar.");
        return;
      }
      const tipo = document.getElementById('registroTipo').value;

      // Enviar datos a Google Apps Script
      fetch('https://script.google.com/macros/s/AKfycbz1taVcLqGM8UqKNpUE9CSxj-Psf7eA2Mt5Mzw40Yv4ikS5HkCD9IMaTL6UIEfmql4S/exec', {
        method: 'POST',
        body: JSON.stringify({ empleados: seleccionados, tipo, foto: fotoBase64 }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(r => r.text())
      .then(msg => { statusMsg.textContent = msg; })
      .catch(err => { statusMsg.textContent = 'Error al enviar: ' + err; });
    };
  </script>
</body>
</html>
