<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de Horas - Google Sheets</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background-color: #f3f6f9; padding: 20px; max-width: 800px; margin: auto; }
    h1 { text-align: center; color: #01487d; }
    form { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
    .employee-row { display: flex; align-items: center; margin-bottom: 10px; }
    .employee-row label { flex: 1; }
    .employee-row input[type=checkbox] { margin-right: 10px; }
    .section { margin-top: 20px; }
    select, textarea, button { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; }
    button { background-color: #007bff; color: #fff; font-weight: bold; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    #resumen { margin-top: 20px; background: #e6f4f1; padding: 15px; border-left: 5px solid #34a853; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Registro de Horas (Google Sheets)</h1>
  <form id="registroForm">
    <div class="section">
      <h2>Entrada</h2>
      <div id="listaEmpleados"></div>
    </div>
    <div class="section">
      <label for="proyecto">Proyecto actual:</label>
      <select id="proyecto" required>
        <option value="">Selecciona proyecto</option>
        <option value="Proyecto A">Proyecto A</option>
        <option value="Proyecto B">Proyecto B</option>
        <option value="Proyecto C">Proyecto C</option>
      </select>
      <label><input type="checkbox" id="cambioProyecto" /> ¿Cambiar proyecto?</label>
      <select id="nuevoProyecto" style="display:none;">
        <option value="">Selecciona nuevo proyecto</option>
        <option value="Proyecto A">Proyecto A</option>
        <option value="Proyecto B">Proyecto B</option>
        <option value="Proyecto C">Proyecto C</option>
      </select>
    </div>
    <div class="section">
      <h2>Salida</h2>
      <label><input type="checkbox" id="checkSalida" /> Registrar salida</label>
    </div>
    <div class="section">
      <label for="notas">Notas del encargado:</label>
      <textarea id="notas" rows="4" placeholder="Especifica qué se realizó..."></textarea>
    </div>
    <button type="submit">Enviar registro</button>
  </form>
  <div id="resumen"></div>
  <script>
    // URL de tu Google Apps Script
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwn0GkyY9daL2zRQgnxx5Fr9UnVfU7MfzbUKZuFlp5lQqhhrAutlGPG_MxizY6x7RwVNg/exec';

    const empleados = ['Cesar', 'Denis', 'Donald', 'Brayan', 'Angel', 'Jeferson', 'Lorenzo'];
    const lista = document.getElementById('listaEmpleados');
    empleados.forEach(name => {
      const row = document.createElement('div');
      row.className = 'employee-row';
      row.innerHTML = `<input type="checkbox" class="checkEntrada" value="${name}" /><label>${name}</label>`;
      lista.appendChild(row);
    });

    document.getElementById('cambioProyecto').addEventListener('change', e => {
      document.getElementById('nuevoProyecto').style.display = e.target.checked ? 'block' : 'none';
    });

    document.getElementById('registroForm').addEventListener('submit', e => {
      e.preventDefault();

      const seleccionados = Array.from(document.querySelectorAll('.checkEntrada:checked')).map(cb => cb.value);
      if (!seleccionados.length) return alert('Selecciona al menos un empleado para registrar entrada.');

      const fecha = new Date().toISOString().split('T')[0];
      const horaEntrada = new Date().toLocaleTimeString('es-ES', { hour12: false, timeZone: 'America/New_York' });

      let proyecto = document.getElementById('proyecto').value;
      if (document.getElementById('cambioProyecto').checked) {
        proyecto = document.getElementById('nuevoProyecto').value || proyecto;
      }

      let horaSalida = '';
      if (document.getElementById('checkSalida').checked) {
        horaSalida = new Date().toLocaleTimeString('es-ES', { hour12: false, timeZone: 'America/New_York' });
      }

      const notas = document.getElementById('notas').value;

      const datos = new URLSearchParams({
        Fecha: fecha,
        Empleados: seleccionados.join(', '),
        HoraEntrada: horaEntrada,
        Proyecto: proyecto,
        HoraSalida: horaSalida,
        Notas: notas
      });

      fetch(scriptURL, { method: 'POST', body: datos })
        .then(res => res.json())
        .then(data => {
          if (data.status === 'success') {
            document.getElementById('resumen').innerHTML = `✅ <strong>Registro exitoso</strong><br>
              <b>Fecha:</b> ${fecha}<br>
              <b>Empleados:</b> ${seleccionados.join(', ')}<br>
              <b>Entrada:</b> ${horaEntrada}<br>
              <b>Proyecto:</b> ${proyecto}<br>
              ${horaSalida ? `<b>Salida:</b> ${horaSalida}<br>` : ''}
              <b>Notas:</b> ${notas}`;
            document.getElementById('registroForm').reset();
            document.getElementById('nuevoProyecto').style.display = 'none';
          } else {
            alert('Error: ' + data.message);
          }
        })
        .catch(err => alert('Error de red: ' + err));
    });
  </script>
</body>
</html>
